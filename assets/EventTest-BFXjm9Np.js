import{d as v,r as S,a as O,b as o,e as n,w as u,F as z,c as E,o as I}from"./index-Di1wMSyr.js";import{S as h}from"./sweetalert2.all-Cezx7DnV.js";const N={color:"blue",zIndex:1059,enforceFocus:!1};function P(f={}){const m=v.useLoading({...N,...f});function y(l={}){const p=document.activeElement;p.blur();const b=m.show({...l});function i(){b.hide(),p.focus()}return{close:i}}return{open:y}}const V={color:"blue",zIndex:1059,enforceFocus:!1};function G(f={}){const m=v.useLoading({...V,...f});function y(l={}){const p=l.container??document.querySelector("#app"),b=new AbortController,i=b.signal;["keydown","keyup"].forEach(s=>{p.addEventListener(s,c=>{console.log(`disable keyboard [${s}]`),c.preventDefault(),c.stopPropagation()},{signal:i,capture:!0})});const r=m.show({...l});function a(){r.hide(),b.abort()}return{close:a}}return{open:y}}const C={color:"blue",zIndex:1059,enforceFocus:!1};function K(f,m){const y={capture:!0};m&&(y.signal=m),["keydown","keyup"].forEach(l=>{f.addEventListener(l,p=>{p.preventDefault(),p.stopPropagation()},y)})}function H(f={}){const m=v.useLoading({...C,...f});function y(l={}){const p=document.activeElement,b=new AbortController;K(document.querySelector("#app"),b.signal);const i=m.show({...l,container:void 0}),r=document.querySelector(".vl-overlay.vl-full-page");K(r),r.focus();function a(){b.abort(),p.focus(),i.hide()}return{close:a}}return{open:y}}function Z(f={}){const m=v.useLoading({...C,...f});function y(l={}){if(!l.container){console.error("container 參數不可為空！");return}const p=m.show(l),b=document.activeElement,i=l.container.getAttribute("tabindex"),r=new AbortController;K(l.container,r.signal),l.container.setAttribute("tabindex","0"),l.container.focus();function a(){l.container.setAttribute("tabindex",i);const s=document.activeElement;(s===l.container||s===l.container.querySelector(".vl-overlay"))&&b.focus(),r.abort(),p.hide()}return{close:a}}return{open:y}}const J=o("h1",{class:"h1"},"測試事件觸發",-1),Q=o("p",null,[o("a",{href:"https://github.com/GitHubPlayerZero/hex-vue3-practise/blob/main/src/views/samples/EventTest.vue",target:"_blank"},"Code")],-1),R=o("hr",{class:"hr mt-0"},null,-1),U=o("h2",{class:"h2"},"基本 form 事件觸發",-1),X=o("p",null,"連續按 Enter 得連續觸發 submit。",-1),Y=o("button",null,"提交",-1),oo=o("hr",{class:"my-5"},null,-1),no=o("h2",{class:"h2"},"form 事件觸發 loading",-1),eo=o("p",null,"測試之後才發現，vue-loading-overlay 竟然沒有防鍵盤操作！",-1),to=o("p",null,"原本的 vue-loading-overlay，使用 Enter 觸發 submit，即使 loading 開啟了也還是可以繼續觸發。",-1),so=o("button",null,"提交",-1),lo=o("h3",{class:"h3 mt-32"},"改寫成自己的 loading - 第一版",-1),io=o("p",null,"方式：開啟 loading 時，使用 blur 強制動作中的元素脫離焦點。",-1),ro=o("p",null,"問題：按 tab 時依然能聚焦下一個元素並對其操作。",-1),co=o("button",null,"提交",-1),ao=o("h3",{class:"h3 mt-32"},"改寫成自己的 loading - 第二版",-1),uo=o("p",null,"方式：開啟 loading 時，禁止鍵盤動作，loading 結束後回復允許鍵盤動作。",-1),po=o("p",null,"問題：無法阻止中文輸入（但也僅僅只能輸入中文，無法做其它動作，因此也不會造成操作異常）。",-1),mo=o("p",null,[n(" 註：原本鍵盤動作是鎖整個 document，但後來發現 SweetAlert2 訊息窗也會變成無法使用鍵盤。"),o("br"),n(" 後來改成鎖 "),o("code",null,"#app"),n(" div，既能達到鎖整個畫面的需求，也能讓 SWAL 正常操作。 ")],-1),yo=o("button",null,"提交",-1),bo=E('<h3 class="h3 mt-32">改寫成自己的 loading - 第三版</h3><p>方式：結合第一、二版的做法並改良。</p><p>此版本將整頁 loading 與區域 loading 的功能分開，考量點有：</p><ul><li class="mb-1">整頁 loading 的功能相較於區域 loading 要單純許多。</li><li class="mb-1">兩者性質不太一樣，需要考量的東西也不太一樣，混雜在一起寫會讓程式變得不必要的複雜。</li><li class="mb-1">區域 loading 的使用機會較少。</li></ul><p>綜上考量，覺得不需要因為區域 loading 而讓整個程式變得複雜，因此將兩者功能分開。</p><p><strong>關閉 loading 時的自動回復元素聚焦效果：</strong><br> loading 開啟時，會將原本動作中的元素移除聚焦，以避免使用者繼續對元素動作。<br> 這邊設計關閉 loading 時，會自動回復元素的聚焦。<br> 然而回復元素聚焦只是一個嘗試的、實驗性的效果，在實務上未必會需要此效果。<br> 在我真正用於作品開發時，發現 loading 自帶回復元素聚焦有時反而會干擾我的流程。<br> 而要不要回復聚焦、或是聚焦在哪個元素，其實我也可以在自己的流程中控制，不需要 loading 自動執行。 </p><h4 class="h4 mb-3 mt-32">整頁 loading</h4><p>構思重點：</p><ul><li class="mb-2">開啟 loading 後，使 loading 取得焦點（原本動作中的元素就會失去焦點），並且禁止鍵盤動作（避免使用 tab）。</li><li class="mb-2"> 開啟 loading 時，禁止 <code>#app</code> div 區域的鍵盤動作，loading 結束後回復允許鍵盤動作。<br> 此設定主要是為了防範有人使用其它偏方強行進入 loading 下方的畫面區域。 </li></ul>',9),fo=o("button",null,"提交",-1),go=E('<h4 class="h4 mb-3 mt-32">區域 loading</h4><p>鍵盤的禁止動作只會限制於 loading 的區域。</p><p>構思重點：</p><ul><li class="mb-2"> 區域 loading 只限於某塊區域，使用者依然可以操作其它部份，因此也可以由外部使用 tab 進入 loading 中的區域。<br> 所以 loading 區域（container）必須禁止鍵盤動作。 </li><li class="mb-2"> 為了更嚴謹的阻擋，將 container 的 tabindex 設為 0（loading 結束時會回復原值）。<br> 如此一來，當由外部使用 tab 時，也只能聚焦於 container，無法對其內容做進一步操作（因為 container 已禁止鍵盤動作）。 </li><li class="mb-2">開啟 loading 後，使 container 取得焦點（原本動作中的元素就會失去焦點）。</li><li class="mb-2"> 對於 loading 關閉後的回復元素聚焦，做了更細緻的考量。<br> 由於開啟 loading 後仍能對網頁其它部份進行操作，如果關閉 loading 時自動聚焦原本的元素，可能會中斷使用者的操作，造成體驗不佳。<br> 因此會判斷目前聚焦的元素，是否為 container 或其 loading（代表使用者沒有進行其它操作），是的話才會重新聚焦原本的元素。 </li></ul>',4),vo=o("p",null,"區域 loading 測試 1。",-1),ho=o("button",null,"提交",-1),Ko=o("p",null,"區域 loading 測試 2。",-1),_o=o("button",null,"提交",-1),wo=o("hr",{class:"my-5"},null,-1),Lo=o("h2",{class:"h2"},"form 事件觸發 alert",-1),xo=o("button",null,"提交",-1),ko=o("hr",{class:"my-5"},null,-1),So=o("h2",{class:"h2"},"form 事件觸發 SweetAlert2",-1),Eo=o("p",null,[n(" 由於 SWAL 預設一定會 focus 在某個 button 上，即使只有 confirm button 並且設定為 "),o("code",null,"focusConfirm: false,"),n("，但仍然會 focus confirm button。"),o("br"),n(" 除非把所有 button 都拿掉..."),o("br"),n(" 這會造成——如果使用者持續按著 Enter，就會直接將訊息窗關閉。"),o("br"),n(" 並且，如果使用者再持續按著 Enter，就會再度觸發隱式提交，然後再度開訊息窗、關訊息窗... 動作不斷循環。 ")],-1),Co=o("button",null,"提交",-1),Ao=o("p",null,[n(" 雖然，我們相信大部份的使用者都不會故意這麼做。"),o("br"),n(" 但一方面，為了避免真的有人惡意為之。"),o("br"),n(" 另一方面，也是為了不想讓使用者太容易就能將訊息關閉，這會提升使用者忽略訊息的機率（根據經驗許多使用者不愛看訊息）。"),o("br"),n(" 因此，可以將訊息窗設定為——只有真的手動點擊了按鈕才會關閉。 ")],-1),To=o("button",null,"提交",-1),Wo={__name:"EventTest",setup(f){const m=v.useLoading({color:"#00f",backgroundColor:"rgba(0,0,123,0.4)"}),y=P(),l=G(),p=H(),b=Z();function i(e){}function r(e){}function a(e){}function s(e){console.log("[input] keydown"),console.log("[input] event ==>",e)}function c(e){console.log("[input] keypress"),console.log("[input] event ==>",e)}function d(e){console.log("[input] keyup"),console.log("[input] event ==>",e)}function _(e){console.log("[input] compositionstart"),console.log("[input] event ==>",e)}function w(e){console.log("[input] compositionupdate"),console.log("[input] event ==>",e)}function L(e){console.log("[input] compositionend"),console.log("[input] event ==>",e)}function A(e){console.log("[form] submit")}function T(e){const t=m.show();console.log("[form] submit"),setTimeout(()=>{t.hide()},5e3)}function j(e){console.log("[form] submit");const t=y.open();setTimeout(()=>{t.close()},5e3)}function $(e){console.log("[form] submit");const t=l.open();setTimeout(()=>{h.fire({title:"訊息測試",didDestroy(){setTimeout(()=>{t.close()},2e3)}})},4e3)}function W(e){console.log("[form] submit");const t=p.open();setTimeout(()=>{h.fire({title:"訊息測試",didDestroy(){setTimeout(()=>{t.close()},6e3)}})},4e3)}const x=S(null);function F(e){console.log("[form] submit");const t=b.open({container:x.value,color:"red",backgroundColor:"rgba(0,0,123,0.4)"});setTimeout(()=>{t.close()},6e3)}const k=S(null);function M(e){console.log("[form] submit");const t=b.open({container:k.value,color:"red",backgroundColor:"rgba(0,0,123,0.4)"});setTimeout(()=>{t.close()},6e3)}function q(e){console.log("[form] submit"),alert("訊息")}function B(e){console.log("[form] submit"),h.fire({title:"訊息",focusConfirm:!1,didOpen(t){t.addEventListener("keydown",g=>{console.log("[popup] keydown")}),t.addEventListener("keypress",g=>{console.log("[popup] keypress")}),t.addEventListener("keyup",g=>{console.log("[popup] keyup")}),t.addEventListener("click",g=>{console.log("[popup] click")})}})}function D(e){console.log("[form] submit"),h.fire({title:"請好好將訊息看完再關閉！",allowEscapeKey:!1,allowOutsideClick:!1,confirmButtonText:"我知道了",didOpen(t){t.focus(),t.addEventListener("keydown",g=>{console.log("[popup] keydown")}),t.addEventListener("keypress",g=>{console.log("[popup] keypress")}),t.addEventListener("keyup",g=>{console.log("[popup] keyup")}),t.addEventListener("click",g=>{console.log("[popup] click")})}})}return(e,t)=>(I(),O(z,null,[J,Q,R,U,X,o("form",{action:"javascript:alert('form action')",class:"box",onKeydown:i,onKeypress:r,onKeyup:a,onSubmit:u(A,["prevent"])},[o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),Y],32),oo,no,eo,to,o("form",{action:"javascript:alert('form action')",class:"box mb-24",onKeydown:i,onKeypress:r,onKeyup:a,onSubmit:u(T,["prevent"])},[o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),so],32),lo,io,ro,o("form",{action:"javascript:alert('form action')",class:"box mb-24",onKeydown:i,onKeypress:r,onKeyup:a,onSubmit:u(j,["prevent"])},[o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),co],32),ao,uo,po,mo,o("form",{action:"javascript:alert('form action')",class:"box mb-24",onKeydown:i,onKeypress:r,onKeyup:a,onSubmit:u($,["prevent"])},[o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d,onCompositionstart:u(_,["prevent"]),onCompositionupdate:u(w,["prevent"]),onCompositionend:u(L,["prevent"])},null,32),n("   "),o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),yo],32),bo,o("form",{action:"javascript:alert('form action')",class:"box mb-24",onKeydown:i,onKeypress:r,onKeyup:a,onSubmit:u(W,["prevent"])},[o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d,onCompositionstart:u(_,["prevent"]),onCompositionupdate:u(w,["prevent"]),onCompositionend:u(L,["prevent"])},null,32),n("   "),o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),fo],32),go,o("div",{class:"vl-parent box mb-24",ref_key:"formLocal",ref:x},[vo,o("form",{action:"javascript:alert('form action')",onKeydown:i,onKeypress:r,onKeyup:a,onSubmit:u(F,["prevent"])},[o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),ho],32)],512),o("div",{class:"vl-parent box mb-24",ref_key:"formLocal2",ref:k,tabindex:"1"},[Ko,o("form",{action:"javascript:alert('form action')",onKeydown:i,onKeypress:r,onKeyup:a,onSubmit:u(M,["prevent"])},[o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),_o],32)],512),wo,Lo,o("form",{action:"javascript:alert('form action')",class:"box",onKeydown:i,onKeypress:r,onKeyup:a,onSubmit:u(q,["prevent"])},[o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),xo],32),ko,So,Eo,o("form",{action:"javascript:alert('form action')",class:"box mb-24",onKeydown:i,onKeypress:r,onKeyup:a,onSubmit:u(B,["prevent"])},[o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),Co],32),Ao,o("form",{action:"javascript:alert('form action')",class:"box",onKeydown:i,onKeypress:r,onKeyup:a,onSubmit:u(D,["prevent"])},[o("input",{type:"text",onKeydown:s,onKeypress:c,onKeyup:d},null,32),n("   "),To],32)],64))}};export{Wo as default};
